# 存在的问题及拟解决措施

**问题一：仿真模型与最终实物形态存在差异。**
目前在ROS 2仿真环境中使用的机器人模型（simple_car_sim）为一个简化的四轮小车，而最终设计的下水道巡检机器人可能具有不同的运动学结构（如履带式或关节式）。这种差异会导致基于小车模型调试的底层运动控制参数（如PID增益、运动学解算矩阵）无法直接应用于最终实物，增加了后续移植的难度。

**拟解决措施：**
采用分层模块化的控制软件架构，将运动学解算层与电机驱动层解耦。在当前阶段，利用小车模型重点验证多任务调度机制、通信协议（CAN总线）以及传感器数据同步接口的逻辑正确性，而非过分纠结于特定车型的运动参数。同时，着手构建最终机器人的URDF模型，以便在后续阶段能够快速替换仿真对象，实现控制算法的平滑迁移。

**问题二：仿真环境的物理逼真度不足。**
当前的管道仿真环境（pipe_world）较为理想化，缺乏真实下水道中常见的湿滑表面、水流冲击以及复杂的几何形变。这使得控制系统在抗干扰能力和鲁棒性方面的测试不够充分，难以暴露在极端工况下可能出现的控制失稳问题。

**拟解决措施：**
在控制算法验证过程中引入随机噪声和扰动模型。虽然无法完全复刻真实物理环境，但可以通过在传感器数据中叠加高斯噪声，或在仿真物理引擎中对机器人施加随机的外力干扰，来模拟打滑和水流冲击的效果。以此重点测试STM32底层控制器的响应速度和闭环控制系统的稳定性，确保系统在非理想条件下仍能保持基本的控制功能。

**问题三：导航系统与底层控制的边界界定问题。**
本项目需要利用视觉和激光雷达信息辅助控制，但完整的SLAM建图与路径规划系统开发工作量巨大且偏离了“底层控制核心”的研究重点。如果缺乏上层导航指令的输入，底层控制系统的闭环测试将难以进行；若投入过多精力研发导航算法，则会挤占优化底层实时控制的时间。

**拟解决措施：**
明确界定项目边界，专注于底层执行与反馈控制。利用ROS 2生态中成熟的导航功能包（如Nav2）或预设的轨迹发生器作为上层指令源，将导航系统视为“黑盒”。本项目的核心工作在于接收上层速度指令后的精准执行、电机PWM的实时调制以及多传感器数据的硬件级同步采集，确保为上层算法提供高质量的底层支持，而非重复造轮子开发导航算法。

**问题四：多任务并发下的实时性保障难题。**
在STM32微控制器上同时处理电机闭环控制、传感器数据采集、CAN总线通信以及上位机指令解析等多个任务时，容易出现资源竞争和时序抖动。如果高优先级的控制回路被低优先级的通信任务阻塞，将导致控制周期不稳定，进而影响机器人的运动平滑性。

**拟解决措施：**
设计基于优先级的抢占式多任务调度程序（或引入FreeRTOS）。将电机PWM生成和编码器读取等对时间敏感的任务设定为最高优先级，通过定时器中断严格保证其执行周期；将数据打包发送和状态监控等任务设定为较低优先级。同时，优化中断服务程序，减少临界区代码长度，确保控制核心在任何负载下都能满足硬实时性的要求。
